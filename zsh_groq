#! /bin/zsh

[ -f "$GROQ_CONFIG/zsh/bake-completion.zsh" ] && . "$GROQ_CONFIG/zsh/bake-completion.zsh"
[ -f "$GROQ_CONFIG/zsh/gr-completion.zsh" ] && . "$GROQ_CONFIG/zsh/gr-completion.zsh"
[ -f "$GROQ_CONFIG/zsh/nix.zsh" ] && . "$GROQ_CONFIG/zsh/nix.zsh"
[ -f "$GROQ_CONFIG/zsh/fix-sft.zsh" ] && . "$GROQ_CONFIG/zsh/fix-sft.zsh"
# ssh X tmux
alias attach="sft ssh --command \"tmux -CC new -As0\""
alias redeploy="sudo -i GROQ_LOG_CONFIG=stderr-also =groq_deploy_client --production-run"

function refresh () {
  if [ -n "$TMUX" ]; then
    eval $(tmux showenv -s)
  fi
}
autoload -Uz refresh
function preexec {
  refresh
}

function builder_tasks() {
  brake-query builder-tasks "$1" \
    "$(date +"%m-%d-%Y")" "$(date -d "tomorrow" +"%m-%d-%Y")"
}

function failed_ci_diag_tasks() {
  python3 ~/.zsh/builder_tasks.py "$@"
}
