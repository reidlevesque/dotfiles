#! /bin/zsh

# PROMPT
function getPwd {
  pwd_length=25
  DIR=`pwd`
  echo $DIR | grep "^$HOME" >> /dev/null
  if [ $? -eq 0 ]
  then
    CURRDIR=`echo $DIR | awk -F$HOME '{print $2}'`
    newPWD="~$CURRDIR"

    if [ $(echo -n $newPWD | wc -c | tr -d " ") -gt $pwd_length ]
    then
      newPWD="~/..$(echo -n $PWD | sed -e "s/.*\(.\{$pwd_length\}\)/\1/")"
    fi
  elif [ "$DIR" = "$HOME" ]
  then
    newPWD="~"
  elif [ $(echo -n $PWD | wc -c | tr -d " ") -gt $pwd_length ]
  then
    newPWD="..$(echo -n $PWD | sed -e "s/.*\(.\{$pwd_length\}\)/\1/")"
  else
    newPWD="$(echo -n $PWD)"
  fi

  echo $newPWD
}

# Docker
function remove-all-docker-containers() {
  docker ps -aq --no-trunc | xargs docker rm
}

function remove-all-docker-images() {
  docker images | awk '{ print $3 }' | xargs -I {} docker rmi {}
}

function remove-trufflehawk-containers ()
{
    docker ps -a | awk '{ print $1,$2,$3 }' | egrep "find_truffles|au-truffle_hawk" | awk '{print $1 }' | xargs -I {} docker rm {}
}

# Git
function clean-git-branches() {
	git checkout rc || git checkout main
	git fetch --prune
	git pull
	git branch -vv | grep 'origin/.*: gone]' | awk '{print $1}' | xargs git branch -D
	git checkout -
	git checkout rc && git pull && git checkout - || true
	git checkout main && git pull && git checkout - || true
}

#Fly
function fly-watch() {
	`echo $1 | perl -p -e 's#.*/pipelines/(.*)/jobs/(.*)/builds/(.*)$#fly watch -t au -j $1/$2 -b $3#g'`
}

# Random
function jwt-decode() {
  jq -R 'split(".") | .[1] | @base64d | fromjson'
}

function wol-clifford() {
  local server_ip=$(dig +short andreaandreid.ddns.net)
  wakeonlan -i "${server_ip}" -p 42464 "2c:f0:5d:98:71:fc"
}
